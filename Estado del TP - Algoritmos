#include "pch.h"
#include <iostream>
#include <conio.h>
#include <windows.h>
#include <iomanip>
using namespace std;
using namespace System;
// Chat GPT
void hidecursor() {
	HANDLE consoleHandle = GetStdHandle(STD_OUTPUT_HANDLE);
	CONSOLE_CURSOR_INFO info;
	GetConsoleCursorInfo(consoleHandle, &info);
	info.bVisible = FALSE;
	SetConsoleCursorInfo(consoleHandle, &info);
}
// ChatGPT
void setColor(int textColor, int bgColor) {
	HANDLE hConsole = GetStdHandle(STD_OUTPUT_HANDLE);
	SetConsoleTextAttribute(hConsole, (bgColor << 4) | textColor);
}
// ChatGPT
void resetColor() {
	HANDLE hConsole = GetStdHandle(STD_OUTPUT_HANDLE);
	SetConsoleTextAttribute(hConsole, 7);
}
int randnum(int min, int max) {
	return min + rand() % (max - min + 1);
}
int randDX() {
	int num = rand() % 2;
	switch (num) {
	case 0:
		num = -1;
		break;
	case 1:
		num = 1;
		break;
	}
	return num;
}
int randDY() {
	int num = rand() % 2;
	switch (num) {
	case 0:
		num = -1;
		break;
	case 1:
		num = 1;
		break;
	}
	return num;
}
int randX() {
	return 2 + rand() % (46 - 1 + 1);
}
int randY() {
	return 2 + rand() % (20 - 1 + 1);
}
char randRecurso() {
	int num = rand() % 3;
	char recurso = ' ';
	switch (num) {
	case 0:
		recurso = '~';
		break;
	case 1:
		recurso = '*';
		break;
	case 2:
		recurso = '#';
		break;
	}
	return recurso;
}

class Obstaculo {
private:
	int x, y;
	char forma;
public:
	Obstaculo(int x, int y, char forma) : x(x), y(y), forma(forma) {}
	~Obstaculo() {}
	void dibujar() {
		Console::SetCursorPosition(x, y);
		cout << forma;
	}
	void setForma(char forma) {
		this->forma = forma;
	}
	void setX(int x) {
		this->x = x;
	}
	void setY(int y) {
		this->y = y;
	}
	char getForma() {
		return this->forma;
	}
	int getX() {
		return this->x;
	}
	int getY() {
		return this->y;
	}
};

class Tablero {
protected:
	int ANCHO;
	int LARGO;
	char** TABLERO;
	Obstaculo** obstaculos;
	int n_Obstaculos;
public:
	Tablero() : ANCHO(25), LARGO(50), TABLERO(nullptr), obstaculos(nullptr), n_Obstaculos(60) {
		TABLERO = new char* [ANCHO];
		for (int i = 0; i < ANCHO; ++i) {
			TABLERO[i] = new char[LARGO];
		}
		for (int i = 0; i < ANCHO; ++i) {
			for (int j = 0; j < LARGO; ++j) {
				// Bordes
				if (i == 0 && j == 0) {
					TABLERO[i][j] = 201;
				}
				else if (i == 0 && j == LARGO - 1) {
					TABLERO[i][j] = 187;
				}
				else if (i == ANCHO - 1 && j == 0) {
					TABLERO[i][j] = 200;
				}
				else if (i == ANCHO - 1 && j == LARGO - 1) {
					TABLERO[i][j] = 188;
				}
				// Paredes
				else if (i == 0 && j > 0 && j < LARGO - 1) {
					TABLERO[i][j] = 205;
				}
				else if (i > 0 && i < ANCHO - 1 && j == 0) {
					TABLERO[i][j] = 186;
				}
				else if (i == ANCHO - 1 && j > 0 && j < LARGO - 1) {
					TABLERO[i][j] = 205;
				}
				else if (i > 0 && i < ANCHO - 1 && j == LARGO - 1) {
					TABLERO[i][j] = 186;
				}
				else {
					TABLERO[i][j] = ' ';
				}
			}
			obstaculos = new Obstaculo * [n_Obstaculos];
			bool valid;
			int posX;
			int posY;
			for (int i = 0; i < n_Obstaculos; ++i) {
				do {
					valid = true;
					posX = randX();
					posY = randY();
					if ((posX > 22 && posX < 27) && (posY > 11 && posY < 15)) {
						valid = false;
					}
				} while (!valid);
				obstaculos[i] = new Obstaculo(posX, posY, 206);
			}
		}
	}
	~Tablero() {
		for (int i = 0; i < ANCHO; ++i) {
			delete[] TABLERO[i];
		}
		delete[] TABLERO;
	}
	void DIBUJAR_MAPA() {
		for (int i = 0; i < ANCHO; ++i) {
			for (int j = 0; j < LARGO; ++j) {
				cout << TABLERO[i][j];
			}
			cout << endl;
		}
	}
	void DIBUJAR_OBSTACULOS() {
		for (int i = 0; i < n_Obstaculos; ++i) {
			Console::SetCursorPosition(obstaculos[i]->getX(), obstaculos[i]->getY());
			setColor(0, 15);
			cout << obstaculos[i]->getForma();
		}
	}
	char getCelda(int x, int y) {
		if (x >= 0 && x < ANCHO && y >= 0 && y < LARGO) {
			return TABLERO[x][y];
		}
		return ' ';
	}
	void setCelda(int x, int y, char c) {
		if (x >= 0 && x < ANCHO && y >= 0 && y < LARGO) {
			TABLERO[x][y] = c;
		}
	}
	Obstaculo** getObstaculo() {
		return this->obstaculos;
	}
	int getN_Obs() {
		return this->n_Obstaculos;
	}
};

class Heroe {
protected:
	int x, y;
	int dx, dy;
	int vidas, salud;
	int PROGRESO;
	float tiempo;
	int* posX_Plantas;
	int* posY_Plantas;
	int n_Plantas;
	int* posX_Arboles;
	int* posY_Arboles;
	int n_Arboles;
	int* posX_Escobas;
	int* posY_Escobas;
	int n_Escobas;
public:
	// Constructor y Destructor
	Heroe() : x(0), y(0), dx(1), dy(1), vidas(3) {}
	Heroe(int x, int y, int dx, int dy, int vidas, int progreso, int tiempo) : 
		x(x), y(y), dx(dx), dy(dy), vidas(vidas),
		PROGRESO(progreso), tiempo(tiempo),
		n_Plantas(0), n_Arboles(0), n_Escobas(0),
		posX_Plantas(nullptr), posY_Plantas(nullptr),
		posX_Arboles(nullptr), posY_Arboles(nullptr),
		posX_Escobas(nullptr), posY_Escobas(nullptr) {}
	~Heroe() {
		if (posX_Plantas > 0) {
			delete[] posX_Plantas;
		}
		if (posY_Plantas > 0) {
			delete[] posY_Plantas;
		}
		if (posX_Arboles > 0) {
			delete[] posX_Arboles;
		}
		if (posY_Arboles > 0) {
			delete[] posY_Arboles;
		}
		if (posX_Escobas > 0) {
			delete[] posX_Escobas;
		}
		if (posY_Escobas > 0) {
			delete[] posY_Escobas;
		}
	}
	void mostrarContador() {
		Console::SetCursorPosition(48, 27);
		cout << setw(2) << int(tiempo);
	}
	// Movimiento
	void dibujar(int x, int y) {
		setColor(3, 15);
		Console::SetCursorPosition(x, y);	  cout << " O ";
		Console::SetCursorPosition(x, y + 1); cout << "<|>";
		Console::SetCursorPosition(x, y + 2); cout << "/ \\";
		resetColor();
	}
	void borrar(int x, int y) {
		setColor(0, 15);
		Console::SetCursorPosition(x, y);	  cout << "   ";
		Console::SetCursorPosition(x, y + 1); cout << "   ";
		Console::SetCursorPosition(x, y + 2); cout << "   ";
	}
	void mover(char input, int n, Obstaculo** obstaculos) {
		bool valid1 = true, valid2 = true, valid3 = true, valid4 = true;

		for (int i = 0; i < n; ++i) {
			if ((x - 1 == obstaculos[i]->getX() && y == obstaculos[i]->getY()) ||
				(x - 1 == obstaculos[i]->getX() && y + 1 == obstaculos[i]->getY()) ||
				(x - 1 == obstaculos[i]->getX() && y + 2 == obstaculos[i]->getY())) {
				valid1 = false;
			}
			if ((x + 3 == obstaculos[i]->getX() && y == obstaculos[i]->getY()) ||
				(x + 3 == obstaculos[i]->getX() && y + 1 == obstaculos[i]->getY()) ||
				(x + 3 == obstaculos[i]->getX() && y + 2 == obstaculos[i]->getY())) {
				valid2 = false;
			}
			if ((y - 1 == obstaculos[i]->getY() && x == obstaculos[i]->getX()) ||
				(y - 1 == obstaculos[i]->getY() && x + 1 == obstaculos[i]->getX()) ||
				(y - 1 == obstaculos[i]->getY() && x + 2 == obstaculos[i]->getX())) {
				valid3 = false;
			}
			if ((y + 3 == obstaculos[i]->getY() && x == obstaculos[i]->getX()) ||
				(y + 3 == obstaculos[i]->getY() && x + 1 == obstaculos[i]->getX()) ||
				(y + 3 == obstaculos[i]->getY() && x + 2 == obstaculos[i]->getX())) {
				valid4 = false;
			}
		}

		if (input == 'A' && valid1 && x > 1) {
			x -= 1;
		}
		if (input == 'D' && valid2 && x < 46) {
			x += 1;
		}
		if (input == 'W' && valid3 && y > 1) {
			y -= 1;
		}
		if (input == 'S' && valid4 && y < 21) {
			y += 1;
		}

		// Actualizar las coordenadas del hÃ©roe
		setX(x);
		setY(y);
	}
	void Labores() {
		int x, y;
		for (int i = 0; i < n_Arboles; ++i) {
			x = posX_Arboles[i];
			y = posY_Arboles[i];
			arbol(x, y);
		}
		for (int i = 0; i < n_Plantas; ++i) {
			x = posX_Plantas[i];
			y = posY_Plantas[i];
			planta(x, y);
		}
		for (int i = 0; i < n_Escobas; ++i) {
			x = posX_Escobas[i];
			y = posY_Escobas[i];
			escoba(x, y);
		}
		resetColor();
	}
	void arbol(int x, int y) {
		setColor(2, 15);
		Console::SetCursorPosition(x, y);		cout << "  /\\";
		Console::SetCursorPosition(x, y + 1);	cout << " /  \\";
		Console::SetCursorPosition(x, y + 2);	cout << "/____\\";
		Console::SetCursorPosition(x, y + 3);	cout << "  ||";
	}
	void planta(int x, int y) {
		setColor(6, 15);
		Console::SetCursorPosition(x, y);		cout << " /---\\";
		Console::SetCursorPosition(x, y + 1);	cout << "|     |";
		Console::SetCursorPosition(x, y + 2);	cout << " \\---/";
		Console::SetCursorPosition(x, y + 3);	cout << "  | |";
	}
	void escoba(int x, int y) {
		setColor(5, 15);
		Console::SetCursorPosition(x, y);		cout << "  ||";
		Console::SetCursorPosition(x, y + 1);	cout << "  ||";
		Console::SetCursorPosition(x, y + 2);	cout << " /||\\";
		Console::SetCursorPosition(x, y + 3);	cout << "//||\\\\";
	}
	void dibujarVidas() {
		Console::SetCursorPosition(6, 26); cout << "Vidas: ";
		for (int i = 0; i < vidas; ++i) {
			setColor(3, 0);
			vida(13 + i * 6, 25);
			resetColor();
		}
	}
	void vida(int x, int y) {
		Console::SetCursorPosition(x, y);	cout << "/-\\/-\\";
		Console::SetCursorPosition(x, y + 1); cout << "\\    /";
		Console::SetCursorPosition(x, y + 2); cout << " \\__/";
	}
	void borrarVida(int i) {
		Console::SetCursorPosition(i * 6 + 7, 25); cout << "      ";
		Console::SetCursorPosition(i * 6 + 7, 26); cout << "      ";
		Console::SetCursorPosition(i * 6 + 7, 27); cout << "      ";
	}
	void mostrarProgreso() {
		Console::SetCursorPosition(20, 28);
		cout << "Progreso:" << setw(3) << PROGRESO << "%";
	}
	void setX(int x) { this->x = x; }
	void setY(int y) { this->y = y; }
	int getX() { return x; }
	int getY() { return y; }
	float getTiempo() { return this->tiempo; }
	void setTiempo(float tiempo) { this->tiempo = tiempo; }
	int getVidas() { return vidas; }
	void setVidas(int vidas) { this->vidas = vidas; }
	int getProgreso() { return this->PROGRESO; }
	void setProgreso(int progreso) { this->PROGRESO = progreso; }
	
	void setX_Plantas(int x) {
		int* copia = new int[n_Plantas + 1];
		for (int i = 0; i < n_Plantas; ++i) {
			copia[i] = posX_Plantas[i];
		}
		copia[n_Plantas] = x;
		delete[] posX_Plantas;
		posX_Plantas = copia;
	}
	void setY_Plantas(int y) {
		int* copia = new int[n_Plantas + 1];
		for (int i = 0; i < n_Plantas; ++i) {
			copia[i] = posY_Plantas[i];
		}
		copia[n_Plantas] = y;
		delete[] posY_Plantas;
		posY_Plantas = copia;
	}
	void setX_Arboles(int x) {
		int* copia = new int[n_Arboles + 1];
		for (int i = 0; i < n_Arboles; ++i) {
			copia[i] = posX_Arboles[i];
		}
		copia[n_Arboles] = x;
		delete[] posX_Arboles;
		posX_Arboles = copia;
	}
	void setY_Arboles(int y) {
		int* copia = new int[n_Arboles + 1];
		for (int i = 0; i < n_Arboles; ++i) {
			copia[i] = posY_Arboles[i];
		}
		copia[n_Arboles] = y;
		delete[] posY_Arboles;
		posY_Arboles = copia;
	}
	void setX_Escobas(int x) {
		int* copia = new int[n_Escobas + 1];
		for (int i = 0; i < n_Escobas; ++i) {
			copia[i] = posX_Escobas[i];
		}
		copia[n_Escobas] = x;
		delete[] posX_Escobas;
		posX_Escobas = copia;
	}
	void setY_Escobas(int y) {
		int* copia = new int[n_Escobas + 1];
		for (int i = 0; i < n_Escobas; ++i) {
			copia[i] = posY_Escobas[i];
		}
		copia[n_Escobas] = y;
		delete[] posY_Escobas;
		posY_Escobas = copia;
	}
	int getN_Plantas() {
		return this->n_Plantas;
	}
	int getN_Arboles() {
		return this->n_Arboles;
	}
	int getN_Escobas() {
		return this->n_Escobas;
	}
	void setN_Plantas(int n) {
		this->n_Plantas = n;
	}
	void setN_Arboles(int n) {
		this->n_Arboles = n;
	}
	void setN_Escobas(int n) {
		this->n_Escobas = n;
	}
};

class Enemigo : public Tablero {
private:
	int x, y;
	int dx;
	char forma;
public:
	Enemigo() {}
	Enemigo(int x, int y, int dx, char forma) : x(x), y(y), dx(dx), forma(forma) {}
	~Enemigo() {}
	void dibujar() {
		Console::SetCursorPosition(x, y);
		cout << forma;
	}
	void borrar() {
		Console::SetCursorPosition(x, y);
		cout << " ";
	}
	void mover() {
		if (x <= 1 || x >= LARGO - 2) {
			dx *= -1;
		}
		x += dx;
	}
	int getX() { return this->x; }
	int getY() { return this->y; }
	char getForma() { return this->forma; }
};

class Recurso : public Tablero {
private:
	int x, y;
	int dx, dy;
	char forma;
public:
	Recurso() {}
	Recurso(int x, int y, int dx, int dy, char forma) : x(x), y(y), dx(dx), dy(dy), forma(forma) {}
	~Recurso() {}
	void dibujar() {
		Console::SetCursorPosition(x, y);
		setColor(8, 15);
		cout << forma;
		resetColor();
	}
	void borrar() {
		Console::SetCursorPosition(x, y);
		setColor(0, 15);
		cout << " ";
		resetColor();
	}
	void mover() {
		if (x <= 1 || x >= LARGO - 2) {
			dx *= -1;
		}
		if (y <= 1 || y >= ANCHO - 2) {
			dy *= -1;
		}
		x += dx;
		y += dy;
	}
	int getX() { return this->x; }
	int getY() { return this->y; }
	char getForma() { return this->forma; }
};

class Juego : public Tablero, public Heroe {
private:
	// Declaraciones de los Objetos
	Heroe* heroe;
	Tablero* tablero;
	Enemigo** enemigos;
	int n_Enemigos;
	Recurso** recursos;
	int n_Recursos;
public:
	Juego() : heroe(new Heroe(24, 11, 1, 1, 5, 0, 45)), tablero(new Tablero()), n_Enemigos(5), n_Recursos(70){
		enemigos = new Enemigo * [n_Enemigos];
		for (int i = 0; i < n_Enemigos; ++i) {
			enemigos[i] = new Enemigo(randX(), randY(), randDX(), 'X');
		}
		recursos = new Recurso * [n_Recursos];
		for (int i = 0; i < n_Recursos; ++i) {
			recursos[i] = new Recurso(randX(), randY(), randDX(), randDY(), randRecurso());
		}
	}
	Juego(int n_Enemigos, int n_Recursos) : heroe(new Heroe(24, 11, 1, 1, 5, 0, 45)), tablero(new Tablero()), n_Enemigos(n_Enemigos), n_Recursos(n_Recursos) {
		enemigos = new Enemigo * [n_Enemigos];
		for (int i = 0; i < n_Enemigos; ++i) {
			enemigos[i] = new Enemigo(randX(), randY(), randDX(), 'X');
		}
		recursos = new Recurso * [n_Recursos];
		for (int i = 0; i < n_Recursos; ++i) {
			recursos[i] = new Recurso(randX(), randY(), randDX(), randDY(), randRecurso());
		}
	}
	~Juego() {
		delete heroe;
		delete tablero;
		for (int i = 0; i < n_Recursos; ++i) {
			delete recursos[i];
		}
		delete[] recursos;

		for (int i = 0; i < n_Enemigos; ++i) {
			delete enemigos[i];
		}
		delete[] enemigos;
	}
	void contextualizacion() {
		system("cls");
		setColor(3, 0);
		Console::SetCursorPosition(0, 10);
		cout << R"(
       En el juego "Guardian del Medio Ambiente"       
      te embarcaras en una mision para restaurar       
    y proteger el ecosistema de un mundo en peligro.   
       Tu objetivo es enfrentar a los enemigos,        
       recolectar recursos y realizar diversas         
          tareas ecologicas para devolverle            
              la salud a la naturaleza.                
)";
		system("pause>0");
		system("cls");
		resetColor();
		setColor(4, 0);
		Console::SetCursorPosition(0, 10);
		cout << R"(
         Te encontraras en un tablero lleno de         
         desafios y oportunidades. Tendras que         
        moverte por el mapa, recolectar recursos       
         valiosos y realizar acciones cruciales        
         como plantar arboles, limpiar areas y         
          reforestar. Cada uno de estos actos          
         contribuira al progreso de tu mision.         
)";
		system("pause>0");
		system("cls");
		resetColor();
		setColor(5, 0);
		Console::SetCursorPosition(0, 10);
		cout << R"(
        Sin embargo, no estaras solo. Enemigos         
        peligrosos rondan el area y trataran de        
      obstaculizar tus esfuerzos. Deberas evitar       
      estos enemigos o enfrentarlos para mantener      
       tus vidas y seguir adelante con tu mision.      
)";
		system("pause>0");
		system("cls");
		resetColor();
		setColor(6, 0);
		Console::SetCursorPosition(0, 10);
		cout << R"(
       Preparate para una aventura emocionante         
         mientras trabajar para restaurar el           
             equilibrio ecologico con                  
                'X', '~', '*' y '#'.                   
-------Buena suerte, Guardian del Medio Ambiente-------
)";
		system("pause>0");
		resetColor();
		system("cls");
		setColor(0, 15);
	}
	void mostrarCreditos() {
		system("cls");
		Console::SetCursorPosition(6, 13); cout << "Integrantes:"; setColor(5, 0);
		Console::SetCursorPosition(6, 14); cout << "- Jean Franck Loa Rojas | u20241E406"; setColor(6, 0);
		Console::SetCursorPosition(6, 15); cout << "- Juan Tintaya Quina    | u202419718"; setColor(3, 0);
		Console::SetCursorPosition(6, 16); cout << "- Joaquin Becerra Salas | u20231F717";
		system("pause>0");
		resetColor();
	}
	bool validacion(int progreso, int vidas, int tiempo) {
		bool end = false;
		if (progreso >= 100 || vidas <= 0 || tiempo <= 0) {
			end = true;
		}
		if (end) {
			system("cls");
			Console::SetCursorPosition(2, 11);
			if (progreso >= 100) {
				setColor(15, 10);
				cout << R"(
  ____    _    _   _    _    ____ _____ _____ 
 / ___|  / \  | \ | |  / \  / ___|_   _| ____|
| |  _  / _ \ |  \| | / _ \ \___ \ | | |  _|  
| |_| |/ ___ \| |\  |/ ___ \ ___) || | | |___ 
 \____/_/   \_\_| \_/_/   \_\____/ |_| |_____|
)";
			}
			else if (vidas <= 0 || tiempo <= 0) {
				setColor(15, 12);
				cout << R"(
 ____  _____ ____  ____ ___ ____ _____ _____ 
|  _ \| ____|  _ \|  _ \_ _/ ___|_   _| ____|
| |_) |  _| | |_) | | | | |\___ \ | | |  _|  
|  __/| |___|  _ <| |_| | | ___) || | | |___ 
|_|   |_____|_| \_\____/___|____/ |_| |_____|
)";
			}
			_sleep(3000);
			resetColor();
			mostrarCreditos();
		}
		return end;
	}
	void Introduccion() {
		setColor(0, 15);
		Console::SetCursorPosition(8, 5);
		cout << R"(
  ____  _                           _    _        
 |  _ \(_)                         (_)  | |       
 | |_)| _  ___ _ __ __  _____ _ __  _  _| | ___   
 |  _ <| |/ _ \ '_  \ \/ / _ \ '_ `| |/ _ |/ _ \  
 | |_)|| |  __/ | | |\  /  __/ | | | | (_|| (_) | 
 |____/|_|\___|_| |_| \/ \___|_| |_|_|\___|\___/  
                      __ _                        
      X              / _` |             ~         
                    | (_| |                       
      O              \__,_|               *       
     <|>        ____ __  __    _                  
     / \       / ___|  \/  |  / \       #         
              | |  _| |\/| | / _ \                
              | |_| | |  | |/ ___ \               
               \____|_|  |_/_/   \_\              

)";
		resetColor();
	}
	void colisionRecursos() {
		int heroeX = heroe->getX();
		int heroeY = heroe->getY();

		for (int i = 0; i < n_Recursos - 1; ++i) {
			for (int dx = 0; dx <= 2; ++dx) {
				for (int dy = 0; dy <= 2; ++dy) {
					if (recursos[i]->getX() == heroeX + dx && recursos[i]->getY() == heroeY + dy) {
						int x = recursos[i]->getX();
						int y = recursos[i]->getY();
						if (recursos[i]->getForma() == '~') {
							heroe->setX_Plantas(x);
							heroe->setY_Plantas(y);
							heroe->setN_Plantas(heroe->getN_Plantas() + 1);
						}
						else if (recursos[i]->getForma() == '*') {
							heroe->setX_Arboles(x);
							heroe->setY_Arboles(y);
							heroe->setN_Arboles(heroe->getN_Arboles() + 1);
						}
						else if (recursos[i]->getForma() == '#') {
							heroe->setX_Escobas(x);
							heroe->setY_Escobas(y);
							heroe->setN_Escobas(heroe->getN_Escobas() + 1);
						}
						heroe->setProgreso(heroe->getProgreso() + 5);
						recursos[i]->borrar();
						eliminarRecurso(i);
						break;
					}
				}
			}
		}
	}
	void colisionEnemigos() {
		int heroeX = heroe->getX();
		int heroeY = heroe->getY();

		for (int i = 0; i < n_Enemigos; ++i) {
			for (int dx = 0; dx <= 2; ++dx) {
				for (int dy = 0; dy <= 2; ++dy) {
					if (enemigos[i]->getX() == heroeX + dx && enemigos[i]->getY() == heroeY + dy) {
						heroe->borrarVida(heroe->getVidas());
						heroe->setVidas(heroe->getVidas() - 1);
					}
				}
			}
		}
	}
	void moverEnemigos() {
		for (int i = 0; i < n_Enemigos; ++i) {
			setColor(12, 15);
			enemigos[i]->borrar();
			enemigos[i]->mover();
			enemigos[i]->dibujar();
			resetColor();
		}
	}
	void moverRecursos() {
		for (int i = 0; i < n_Recursos; ++i) {
			setColor(8, 15);
			recursos[i]->borrar();
			recursos[i]->mover();
			recursos[i]->dibujar();
			resetColor();
		}
	}
	void eliminarRecurso(int indice) {
		delete recursos[indice];
		for (int i = indice; i < n_Recursos - 1; ++i) {
			recursos[i] = recursos[i + 1];
		}
		--n_Recursos;
		Recurso** copia = new Recurso * [n_Recursos];
		for (int i = 0; i < n_Recursos; ++i) {
			copia[i] = recursos[i];
		}
		delete[] recursos;
		recursos = copia;
	}
	void iniciarJuego() {
		contextualizacion();
		char input;
		int prevx;
		int prevy;
		bool final = false;
		heroe->setVidas(5);
		heroe->setTiempo(45);
		heroe->setProgreso(0);
		tablero->DIBUJAR_MAPA();
		while (!final) {
			tablero->DIBUJAR_OBSTACULOS();
			heroe->Labores();
			moverRecursos();
			moverEnemigos();

			prevx = heroe->getX();
			prevy = heroe->getY();
			heroe->borrar(prevx, prevy);

			if (_kbhit()) {
				input = toupper(_getch());
				heroe->mover(input, tablero->getN_Obs(), tablero->getObstaculo());
			}

			heroe->dibujar(heroe->getX(), heroe->getY());
			colisionRecursos();
			colisionEnemigos();
			heroe->dibujarVidas();
			heroe->mostrarProgreso();
			_sleep(50);
			heroe->mostrarContador();
			heroe->setTiempo(heroe->getTiempo() - 0.07);
			final = validacion(heroe->getProgreso(), heroe->getVidas(), heroe->getTiempo());
		}
	}
};

void printMenu(int selected = 0) {
	const string options[] = { "1. Jugar", "2. Mostrar creditos", "3. Salir"};
	const int numOptions = sizeof(options) / sizeof(options[0]);
	system("cls");
	for (int i = 0; i < numOptions; ++i) {
		Console::SetCursorPosition(15, 13 + i);

		if (i == selected) {
			setColor(12, 0);
			cout << "-> ";
			resetColor();
			cout << options[i] << endl;
		}
		else {
			cout << "   " << options[i] << endl;
		}
	}
}

void Menu(Juego* ObjJuego) {
	int selected = 0;
	const int numOptions = 3;
	char input;
	int dificultadInput;
	bool ready = false;
	while (true) {
		printMenu(selected);

		input = toupper(_getch());

		switch (input) {
		case 'W':
			selected = (selected - 1 + numOptions) % numOptions;
			break;
		case 'S':
			selected = (selected + 1) % numOptions;
			break;
		case '\r':
			switch (selected) {
			case 0:
				while (!ready) {
					system("cls");
					setColor(3, 15);
					Console::SetCursorPosition(7, 12); cout << "Selecciona la dificultad: ";
					setColor(15, 0);
					Console::SetCursorPosition(7, 13); cout << "1. Facil - 50 recursos, 3 enemigos";
					Console::SetCursorPosition(7, 14); cout << "2. Medio - 40 recursos, 5 enemigos";
					Console::SetCursorPosition(7, 15); cout << "3. Dificil - 30 recursos, 7 enemigos";
					Console::SetCursorPosition(7, 16); cout << "4. Extremo - 20 recursos, 9 enemigos";
					resetColor();

					dificultadInput = _getch() - '0'; // Lee la entrada del usuario

					// AsegÃºrate de que la entrada sea vÃ¡lida
					switch (dificultadInput) {
					case 1:
						ObjJuego = new Juego(3, 51);
						break;
					case 2:
						ObjJuego = new Juego(5, 41);
						break;
					case 3:
						ObjJuego = new Juego(7, 31);
						break;
					case 4:
						ObjJuego = new Juego(9, 21);
						break;
					default:
						Console::SetCursorPosition(7, 17);
						cout << "Opcion invalida, elige una opcion del 1 al 4.\n";
						system("pause");
						break;
					}
					if (dificultadInput == 1 || dificultadInput == 2 || dificultadInput == 3 || dificultadInput == 4) {
						ready = true;
					}
				}
				ObjJuego->iniciarJuego();
				break;
			case 1:
				ObjJuego->mostrarCreditos();
				break;
			case 2:
				cout << "Saliendo..." << endl;
				setColor(0, 0);
				exit(0);
				break;
			}
			system("pause>0");
			break;
		default:
			cout << "Usa [W/S] para navegar y [Enter] para seleccionar." << endl;
			system("pause");
			break;
		}
	}
}

void UPClogo(int x, int y) {
	system("cls");
	Console::SetCursorPosition(x, y);
	const int height = 20;
	const int width = 40;
	int UPC[height][width] = {
		{2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2},
		{2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2},
		{2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2},
		{2,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,2},
		{2,2,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,2,2},
		{2,2,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,2,2},
		{2,2,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,2,2},
		{2,2,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,2,2},
		{2,2,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,2,2},
		{2,2,0,0,0,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,2,2},
		{2,2,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,2,2},
		{2,2,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,2,2},
		{2,2,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,2,2},
		{2,2,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,2,2},
		{2,2,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,2,2},
		{2,2,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,1,1,1,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,2,2},
		{2,2,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,2,2},
		{2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2},
		{2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2},
		{2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2},

	};
	for (int i = 0; i < height; i++) {
		for (int j = 0; j < width; ++j) {
			if (UPC[i][j] == 0) {
				setColor(15, 15);
				cout << "#";
			}
			if (UPC[i][j] == 1) {
				setColor(4, 4);
				cout << "#";
			}
			if (UPC[i][j] == 2) {
				setColor(8, 8);
				cout << "#";
			}
		}
		Console::SetCursorPosition(x, y++);
	}
	resetColor();
	Console::SetCursorPosition(x += 8, y++);
	cout << "-Exigete, Innova, UPC-";
	Sleep(3000);
	Console::SetCursorPosition(0, 0);
	system("cls");
	resetColor();
}

void TrabajoParcial() {
	hidecursor();
	UPClogo(4, 5);
	Juego* ObjJuego = new Juego();
	ObjJuego->Introduccion();
	_sleep(3000);
	Menu(ObjJuego);
	delete ObjJuego;
}

int main() {
	srand(time(0));
	TrabajoParcial();
	return 0;
}
